(()=>{"use strict";class e{constructor(e,t,p,l,i,s,a){this.angularLoad=e,this.studioConfig=t,this.$http=p,this.$scope=l,this.$element=i,this.$timeout=s,this.$window=a}getConfigApiKey(){return this.studioConfig[0].apikey||""}getConfigISBN(){return this.studioConfig[0].isbn||""}getConfigWidgetType(){return this.studioConfig[0].widgettype||"print"}getConfigWidgetTheme(){return this.studioConfig[0].widgettheme||"default"}$onInit(){let e=this;switch(e.embed_js="",e.plumx_js="https://cdn.plu.mx/widget-",e.plumx_cssid="plx-css-",e.plumx_url="",e.plumx_popup="",e.plumx_badge="",e.getConfigWidgetType()){default:case"print":e.plumx_class="plumx-plum-print-popup",e.plumx_popup="right",e.plumx_js+="popup.js",e.plumx_cssid+="popup";break;case"details":e.plumx_class="plumx-details",e.plumx_js+="details.js",e.plumx_cssid+="details";break;case"summary":e.plumx_class="plumx-summary",e.plumx_js+="summary.js",e.plumx_cssid+="summary";break;case"badge":e.plumx_class="plumx-plum-print-popup",e.plumx_popup="right",e.plumx_badge="true",e.plumx_js+="popup.js",e.plumx_cssid+="popup"}switch(e.getConfigWidgetTheme()){default:case"default":break;case"bigben":e.plumx_class+=" plumx-bigben-theme";break;case"liberty":e.plumx_class+=" plumx-liberty-theme"}e.parentElement=e.$element.parent().parent()[0],e.api="doi";try{e.doi=e.parentCtrl.item.pnx.addata.doi[0]||""}catch(t){try{e.getConfigISBN()&&(e.doi=e.parentCtrl.item.pnx.addata.isbn[0]||"",e.api="isbn")}catch(e){return}}e.doi&&e.$timeout((()=>{e.plumx_api="https://api.plu.mx/widget/other/artifact?type="+e.api+"&id="+e.doi+"&site=plum",e.$http.get("https://corsproxy.io/?"+e.plumx_api,{headers:{Accept:"application/json"}}).then((t=>{200!=t.status||"error_code"in t.data||(e.plumx_url="https://plu.mx/plum/a/?"+e.api+"="+e.doi,e.embed_js=e.plumx_js+"?"+Date.now(),e.angularLoad.loadScript(e.embed_js).then((()=>{e.parentCtrl.services.splice(e.parentCtrl.services.length,0,{scrollId:"plumx",serviceName:"plumx",title:"brief.results.tabs.PlumX"})}),(e=>{console.log("plumx loadScript failed: "+e)})))}),(e=>{console.log("plumx api failed: "+e)}))}),3e3);let t=e.$scope.$watch((()=>e.parentElement.querySelector('h4[translate="brief.results.tabs.PlumX"]')),((p,l)=>{if(p){let l=p.parentElement.parentElement.parentElement.parentElement.children[1];l&&l.appendChild&&l.appendChild(e.$element[0]),t()}}))}$onDestroy(){let e=this,t=null;e.$window.__plumX&&delete e.$window.__plumX,t=e.$window.document.body.querySelector('[src="'+e.embed_js+'"]'),t&&t.remove(),t=e.$window.document.head.querySelector('link[id="'+e.plumx_cssid+'"]'),t&&t.remove(),e.$window.document.head.querySelectorAll("script").forEach((e=>{(e.src.endsWith("jquery/1.10.2/jquery.min.js")||e.src.endsWith("extjs/xss.js"))&&e.parentNode.removeChild(e)}))}}e.$inject=["angularLoad","primoStudioPlumxStudioConfig","$http","$scope","$element","$timeout","$window"];const t={selector:"primoStudioPlumx",controller:e,bindings:{parentCtrl:"<"},template:'<div id="plumx_widget" ng-if="$ctrl.plumx_url"> <a ng-href="{{$ctrl.plumx_url}}" class="{{$ctrl.plumx_class}}" data-size="large" data-popup="{{$ctrl.plumx_popup}}" data-badge="{{$ctrl.plumx_badge}}" data-site="plum" data-hide-when-empty="true" target="_blank">PlumX {{$ctrl.doi}}</a> </div> '},p=angular.module("primoStudioPlumx",[]).component(t.selector,t).name;app.requires.push(p)})();